<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Graczy - ACG (Live)</title>
    <link rel="stylesheet" href="./style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="navbar">
        <div class="logo-section">
            <img src="logo.png" alt="Logo" class="logo">
            <span class="site-name"></span>
        </div>
        <nav class="nav-links">
            <a href="index.html">STRONA GŁÓWNA</a>
            <a href="historia.html">HISTORIA GIER</a>
            <a href="statystyki.html">STATYSTYKI</a>
            <a href="soloq.html">SOLOQ</a>
            <a href="ranking.html">RANKING</a>
            <a href="dodajmecz.html">DODAJ MECZ</a>
        </nav>
    </header>

    <main class="soloq-main">
        <h1>Ranking Graczy ACG (Na Żywo)</h1>
        <div id="players-ranking-container" class="ranking-list">
            <p id="loading-message" style="text-align: center; font-size: 1.2em;">Ładowanie rankingu, proszę czekać...</p>
        </div>
        <p id="last-updated" style="text-align: center; color: #888; margin-top: 20px;"></p>
    </main>

    <footer>
        <p>2025 &copy; ACG - AC GDAŃSK</p>
    </footer>

    <script>
        // --- KONFIGURACJA ---
        const RIOT_API_KEY = "RGAPI-ceec8f6f-4325-4d64-be9d-717fe6169912"; // PAMIĘTAJ O WYMIANIE KLUCZA
        const REFRESH_INTERVAL_MS = 300000; // 300,000 ms = 5 minut

        // Lista graczy do śledzenia w rankingu
        const playersToTrack = [
            { displayName: 'reap777', riotId: 'pizza fanboy', tagLine: 'EUNE' },
            { displayName: 'Kohayushi', riotId: 'Kohayushi', tagLine: 'acg' },
            { displayName: 'Weedolas', riotId: 'Weedolas', tagLine: '4WB' },
            { displayName: 'Yanny', riotId: 'Hide on fpl', tagLine: 'eune' },
            { displayName: 'Likht', riotId: 'Likht', tagLine: 'EUNE' }
        ];

        // Mapy do sortowania rang
        const rankValueMap = { 'iron': 0, 'bronze': 1, 'silver': 2, 'gold': 3, 'platinum': 4, 'emerald': 5, 'diamond': 6, 'master': 7, 'grandmaster': 8, 'challenger': 9 };
        const divisionValueMap = { 'I': 4, 'II': 3, 'III': 2, 'IV': 1 };
        const rankImageMap = {
            'iron': 'iron.png', 'bronze': 'bronze.png', 'silver': 'silver.png',
            'gold': 'gold.png', 'platinum': 'platinum.png', 'emerald': 'emerald.png',
            'diamond': 'diamond.png', 'master': 'master.png', 'grandmaster': 'grandmaster.png',
            'challenger': 'challenger.png'
        };


        // --- ELEMENTY DOM ---
        const playersContainer = document.getElementById('players-ranking-container');
        const loadingMessage = document.getElementById('loading-message');
        const lastUpdatedP = document.getElementById('last-updated');


        // --- FUNKCJE API (skopiowane z `script.js` i uproszczone) ---
        const API_CALL_DELAY_MS = 1200;
        function delay(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

        async function getPuuid(riotId, tagLine) {
            const url = `https://europe.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${encodeURIComponent(riotId)}/${encodeURIComponent(tagLine)}?api_key=${RIOT_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Nie znaleziono konta dla ${riotId}#${tagLine}`);
            const data = await response.json();
            return data.puuid;
        }

        async function getSummonerId(puuid) {
            const url = `https://eun1.api.riotgames.com/lol/summoner/v4/summoners/by-puuid/${puuid}?api_key=${RIOT_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Nie znaleziono przywoływacza dla PUUID ${puuid}`);
            const data = await response.json();
            return data.id;
        }

        async function getRankData(summonerId) {
            const url = `https://eun1.api.riotgames.com/lol/league/v4/entries/by-summoner/${summonerId}?api_key=${RIOT_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) return null; // Może być unranked
            const data = await response.json();
            return data.find(q => q.queueType === 'RANKED_SOLO_5x5') || null;
        }

        // --- GŁÓWNA LOGIKA ---

        async function fetchPlayerRank(player) {
            try {
                const puuid = await getPuuid(player.riotId, player.tagLine);
                await delay(API_CALL_DELAY_MS);
                const summonerId = await getSummonerId(puuid);
                await delay(API_CALL_DELAY_MS);
                const rankData = await getRankData(summonerId);

                if (rankData) {
                    return {
                        name: player.displayName,
                        tier: rankData.tier.toLowerCase(),
                        rank: rankData.rank,
                        lp: rankData.leaguePoints
                    };
                } else {
                    return { name: player.displayName, tier: 'unranked', rank: '', lp: 0 };
                }
            } catch (error) {
                console.error(`Błąd podczas pobierania danych dla ${player.displayName}:`, error);
                return { name: player.displayName, tier: 'error', rank: 'Błąd', lp: 0 };
            }
        }

        function renderRanking(playersData) {
            playersContainer.innerHTML = ''; // Wyczyść kontener

            playersData.sort((a, b) => {
                const rankAValue = rankValueMap[a.tier] ?? -1;
                const rankBValue = rankValueMap[b.tier] ?? -1;
                if (rankAValue !== rankBValue) return rankBValue - rankAValue;

                const divisionAValue = divisionValueMap[a.rank] ?? 0;
                const divisionBValue = divisionValueMap[b.rank] ?? 0;
                if (divisionAValue !== divisionBValue) return divisionBValue - divisionAValue;

                return b.lp - a.lp;
            });

            playersData.forEach((player, index) => {
                const rankNumber = index + 1;
                const rankNameDisplay = player.tier.charAt(0).toUpperCase() + player.tier.slice(1);
                const fullRankText = (player.tier === 'unranked' || player.tier === 'error') ? rankNameDisplay : `${rankNameDisplay} ${player.rank}`;

                const iconFileName = rankImageMap[player.tier] || 'default.png';
                const iconPath = `Images/${iconFileName}`;

                const playerItem = document.createElement('div');
                playerItem.className = 'player-rank-item';
                playerItem.innerHTML = `
                    <div class="rank-number">${rankNumber}.</div>
                    <div class="player-info">
                        <img src="${iconPath}" alt="Ikona Rangi" class="rank-icon">
                        <div class="player-name-and-rank">
                            <span class="player-name">${player.name}</span>
                            <span class="player-rank-text">${fullRankText}</span>
                            <span class="player-lp-display">LP: ${player.lp}</span>
                        </div>
                    </div>
                    <div class="player-stats">
                        </div>
                `;
                playersContainer.appendChild(playerItem);
            });
            
            lastUpdatedP.textContent = `Ostatnia aktualizacja: ${new Date().toLocaleTimeString('pl-PL')}`;
        }

        async function updateAllPlayerRanks() {
            console.log("Rozpoczynam aktualizację rankingu...");
            loadingMessage.style.display = 'block';
            playersContainer.innerHTML = ''; // Wyczyść stary ranking podczas ładowania

            const promises = playersToTrack.map(player => fetchPlayerRank(player));
            const playersData = await Promise.all(promises);

            loadingMessage.style.display = 'none';
            renderRanking(playersData);
            console.log("Aktualizacja rankingu zakończona.");
        }

        // --- INICJALIZACJA ---
        document.addEventListener('DOMContentLoaded', () => {
            updateAllPlayerRanks(); // Uruchom pierwszy raz po załadowaniu strony
            setInterval(updateAllPlayerRanks, REFRESH_INTERVAL_MS); // Ustaw automatyczne odświeżanie
        });

    </script>
</body>
</html>