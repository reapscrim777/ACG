<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Graczy - ACG</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        // Twoja konfiguracja Firebase (Zastąp XXXX swoimi danymi z Konsoli Firebase)
        const firebaseConfig = {
          apiKey: "YOUR_API_KEY", // np. "AIzaSyC..."
          authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // np. "mojerangilol.firebaseapp.com"
          projectId: "YOUR_PROJECT_ID", // np. "mojerangilol"
          storageBucket: "YOUR_PROJECT_ID.appspot.com",
          messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
          appId: "YOUR_APP_ID"
        };

        // Inicjalizuj Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    <style>
        /* General Body and Navbar styles - taken from your provided HTML */
        body {
            background-color: #222; /* Tło strony */
            color: #eee; /* Kolor tekstu */
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Rozciągnij stronę na całą wysokość widoku */
            overflow-y: auto; /* Pozwól na przewijanie zawartości */
        }

        /* Dopasuj navbar do oryginalnego wyglądu z index.html */
        .navbar {
            background-color: #1a1a1a; /* Tło nawigacji */
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            position: fixed; /* Przyklejony do góry */
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000; /* Upewnij się, że jest nad innymi elementami */
        }

        .navbar .logo-section {
            display: flex;
            align-items: center;
        }

        .navbar .logo {
            height: 40px; /* Wysokość logo */
            margin-right: 10px;
        }

        .navbar .site-name {
            color: #fff;
            font-size: 1.5em;
            font-weight: 600;
        }

        .navbar .nav-links a {
            color: #fff;
            text-decoration: none;
            margin-left: 25px;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .navbar .nav-links a:hover {
            color: #007bff; /* Kolor po najechaniu */
        }

        /* Główna sekcja contentu dla Rankingu */
        .ranking-content {
            padding: 100px 20px 40px 20px;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .ranking-content h1 {
            color: #007bff;
            margin-bottom: 40px;
            font-size: 2.5em;
        }

        /* ZMIENIONE STYLE NA FORMĘ RANKINGU (LISTY) */
        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 10px; /* Odstęp między wierszami rankingu */
            width: 100%;
            max-width: 700px; /* Maksymalna szerokość listy, nieco większa */
            margin: 0 auto; /* Wyśrodkowanie listy */
        }

        .player-rank-item {
            background-color: #333;
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between; /* Rozłóż elementy */
            font-size: 0.95em;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-sizing: border-box; /* Ważne dla paddingu i szerokości */
        }

        .player-rank-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        .rank-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            min-width: 40px; /* Stała szerokość dla numeru rankingu */
            text-align: right;
            margin-right: 15px;
        }

        .player-info {
            display: flex;
            align-items: center;
            flex-grow: 1; /* Pozwól zająć dostępną przestrzeń */
            gap: 10px;
            text-align: left; /* Wyrównaj tekst do lewej */
        }

        .rank-icon {
            width: 40px; /* Mniejsza ikona */
            height: 40px;
            border-radius: 50%;
            border: 2px solid #007bff;
            flex-shrink: 0; /* Zapobiegaj zmniejszaniu ikony */
        }

        .player-name-and-rank {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex-grow: 1; /* Pozwól na rozciąganie */
            min-width: 100px; /* Minimalna szerokość, żeby się nie łamało za wcześnie */
        }
        .player-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #eee;
            line-height: 1.2;
            white-space: nowrap; /* Zapobiegaj łamaniu nazwy */
            overflow: hidden;
            text-overflow: ellipsis; /* Dodaj trzy kropki, jeśli nazwa jest za długa */
        }
        .player-rank-text {
            font-size: 0.8em;
            color: #bbb;
            white-space: nowrap;
        }

        .player-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* Wyrównaj statystyki do prawej */
            font-size: 0.85em;
            color: #ccc;
            min-width: 120px; /* Upewnij się, że jest miejsce na statystyki */
            text-align: right;
            flex-shrink: 0;
        }

        .player-links {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-left: 15px;
            flex-shrink: 0;
            text-align: right;
        }

        .player-links a {
            color: #7fffd4;
            text-decoration: none;
            font-size: 0.75em;
            white-space: nowrap; /* Zapobiegaj łamaniu linków */
        }
        .player-links a:hover {
            color: #00bfff;
            text-decoration: underline;
        }

        /* Responsywność dla małych ekranów */
        @media (max-width: 768px) {
            .ranking-list {
                max-width: 100%;
            }
            .player-rank-item {
                flex-wrap: wrap; /* Zwijanie na mniejszych ekranach */
                justify-content: flex-start;
                padding: 10px;
            }
            .rank-number {
                margin-right: 10px;
                min-width: unset;
                text-align: left;
                order: 1; /* Pierwszy w kolejności */
            }
            .player-info {
                flex-grow: unset;
                width: calc(100% - 50px); /* Dopasuj do numeru rankingu i paddingu */
                order: 2; /* Drugi w kolejności */
            }
            .player-stats {
                width: 100%;
                align-items: flex-start;
                margin-top: 5px;
                margin-left: 50px; /* Wyrównaj pod nazwą gracza */
                order: 3; /* Trzeci w kolejności */
            }
            .player-links {
                width: 100%;
                align-items: flex-start;
                margin-top: 5px;
                margin-left: 50px; /* Wyrównaj pod nazwą gracza */
                order: 4; /* Czwarty w kolejności */
            }
        }
        @media (max-width: 480px) {
            .ranking-content h1 {
                font-size: 2em;
            }
            .rank-number {
                font-size: 1.3em;
            }
            .player-name {
                font-size: 1em;
            }
            .player-rank-text {
                font-size: 0.75em;
            }
            .player-stats span {
                font-size: 0.8em;
            }
            .player-links a {
                font-size: 0.7em;
            }
        }


        /* Styl dla sekcji linków na dole (byłe footer2) */
        .footer-bottom-links {
            background-color: #1a1a1a;
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            width: 100%;
            margin-top: auto; /* Pcha stopkę na dół */
        }

        .footer-bottom-links a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #fff;
            font-size: 0.9em;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .footer-bottom-links a:hover {
            color: #007bff;
        }

        .footer-bottom-links img {
            height: 40px;
            width: 40px;
            border-radius: 50%;
            margin-bottom: 5px;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .footer-bottom-links a:hover img {
            border-color: #007bff;
        }

        /* Główna stopka */
        footer {
            background-color: #111;
            color: #aaa;
            text-align: center;
            padding: 15px 20px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="logo-section">
            <img src="logo.png" alt="Logo" class="logo">
            <span class="site-name"></span>
        </div>
        <nav class="nav-links">
            <a href="index.html">STRONA GŁÓWNA</a>
            <a href="historia.html">HISTORIA GIER</a>
            <a href="statystyki.html">STATYSTYKI</a>
            <a href="soloq.html">SOLOQ</a>
            <a href="ranking.html">RANKING</a>
            <a href="dodajmecz.html">DODAJ MECZ</a>
        </nav>
    </header>

    <main class="ranking-content">
        <h1>Ranking Graczy ACG</h1>
        
        <div id="players-ranking-container" class="ranking-list">
          <p>Ładowanie rankingu...</p>
        </div>

    </main>

    <footer2 class="footer-bottom-links">
        <a href="https://op.gg/pl/lol/summoners/eune/likht-EUNE" target="_blank">
            <img src="top.png" alt="Ikona 1">
            <span>LIKHT</span>
        </a>
        <a href="https://op.gg/pl/lol/summoners/eune/Weedolas-4WB" target="_blank">
            <img src="jg.png" alt="Ikona 2">
            <span>WEEDOLAS</span>
        </a>
        <a href="https://op.gg/pl/lol/summoners/eune/pizza%20fanboy-EUNE" target="_blank">
            <img src="mid.png" alt="Ikona 3">
            <span>REAP</span>
        </a>
        <a href="https://op.gg/pl/lol/summoners/eune/kohayushi-acg" target="_blank">
            <img src="bot.png" alt="Ikona 4">
            <span>KOHAYUSHI</span>
        </a>
        <a href="strona5.html" target="_blank">
            <img src="sup.png" alt="Ikona 5">
            <span>NONE</span>
        </a>
    </footer2>

    <footer>
        <p>2025 &copy; ACG - AC GDAŃSK</p>
    </footer>

    <script>
        // Funkcja do pobierania danych i aktualizowania interfejsu
        async function loadPlayerRanks() {
            const playersRankingContainer = document.getElementById('players-ranking-container');
            playersRankingContainer.innerHTML = '<p>Ładowanie rankingu...</p>';

            try {
                // Pobierz dane z Firestore i posortuj je
                const snapshot = await db.collection('playerRanks').get();
                let players = [];
                snapshot.forEach(doc => {
                    players.push(doc.data());
                });

                // Sortowanie graczy: najpierw po randze, potem po dywizji, potem po LP
                const rankOrder = {
                    'Challenger': 9, 'Grandmaster': 8, 'Master': 7,
                    'Diamond': 6, 'Emerald': 5, 'Platinum': 4,
                    'Gold': 3, 'Silver': 2, 'Bronze': 1, 'Iron': 0, 'Unranked': -1
                };

                players.sort((a, b) => {
                    const aRankName = a.rank ? a.rank.split(' ')[0] : 'Unranked';
                    const bRankName = b.rank ? b.rank.split(' ')[0] : 'Unranked';
                    // Konwersja dywizji rzymskiej na int, obsługuje brak dywizji (np. Master, Grandmaster, Challenger)
                    const aDivision = a.rank && a.rank.split(' ')[1] ? romanToInt(a.rank.split(' ')[1]) : 0;
                    const bDivision = b.rank && b.rank.split(' ')[1] ? romanToInt(b.rank.split(' ')[1]) : 0;

                    // 1. Sortuj po głównej randze (np. Diamond vs Platinum)
                    if (rankOrder[bRankName] !== rankOrder[aRankName]) {
                        return rankOrder[bRankName] - rankOrder[aRankName];
                    }
                    // 2. Jeśli rangi są takie same, sortuj po dywizji (I > II > III > IV)
                    //   Mniejsza liczba rzymska to lepsza dywizja (np. I=1, II=2), więc a-b
                    if (aDivision !== bDivision) {
                        return aDivision - bDivision;
                    }
                    // 3. Jeśli ranga i dywizja są takie same, sortuj po LP (więcej LP jest lepsze)
                    return b.lp - a.lp;
                });

                // Funkcja pomocnicza do konwersji rzymskich cyfr na int (dla dywizji)
                function romanToInt(roman) {
                    const map = { 'I': 1, 'II': 2, 'III': 3, 'IV': 4 };
                    return map[roman] || 0; // Zwraca 0, jeśli nie znaleziono (np. dla unranked, master bez dywizji)
                }

                let playersHtml = '';
                if (players.length === 0) {
                    playersHtml = '<p>Brak danych o graczach w bazie. Upewnij się, że funkcja Cloud Function działa poprawnie.</p>';
                } else {
                    players.forEach((data, index) => {
                        const rankNumber = index + 1; // Numeracja od 1
                        // Dzielenie nazwy rangi na część tekstową (np. Diamond) i dywizję (np. IV)
                        const rankBaseName = data.rank ? data.rank.split(' ')[0].toLowerCase() : 'unranked';
                        // Upewnij się, że nazwa rangi do pliku grafiki jest poprawna (np. 'master' zamiast 'Master')
                        const emblemFileName = `emblem-${rankBaseName}.png`;

                        playersHtml += `
                            <div class="player-rank-item">
                                <div class="rank-number">${rankNumber}.</div>
                                <div class="player-info">
                                    <img src="https://raw.githubusercontent.com/davidmlester/league-ranked-emblems/master/images/${emblemFileName}" alt="Ikona Rangi ${data.name}" class="rank-icon">
                                    <div class="player-name-and-rank">
                                        <span class="player-name">${data.name}</span>
                                        <span class="player-rank-text">${data.rank}</span>
                                    </div>
                                </div>
                                <div class="player-stats">
                                    <span>LP: ${data.lp}</span>
                                    <span>WR: ${data.winRate}%</span>
                                    <span>W/L: ${data.wins}W / ${data.losses}L</span>
                                </div>
                                <div class="player-links">
                                    <a href="https://zeal.gg/profile/${data.region}/${encodeURIComponent(data.summonerName)}" target="_blank">Zeal.gg</a>
                                    <a href="https://op.gg/pl/lol/summoners/${data.region}/${encodeURIComponent(data.summonerName)}" target="_blank">OP.GG</a>
                                </div>
                            </div>
                        `;
                    });
                }
                playersRankingContainer.innerHTML = playersHtml;
            } catch (error) {
                console.error("Błąd podczas pobierania danych z Firestore:", error);
                playersRankingContainer.innerHTML = '<p>Wystąpił błąd podczas ładowania rankingu. Sprawdź konsolę, aby uzyskać szczegóły.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadPlayerRanks);
    </script>
</body>
</html>
